<!doctype html>
<html>
<head>
<meta charset="UTF-8">
<script type="text/javascript" src="lib/jquery-1.12.0.min.js"></script>
<script type="text/javascript" src="lib/jquery.json.min.js"></script>
<script type="text/javascript" src="lib/jquery.simple.websocket.js"></script>
<script type="text/javascript" src="config.js"></script>
<script type="text/javascript">
	//Connect to ProPresenter Remote Stage Display
    var webSocket = $.simpleWebSocket({ url: 'ws://'+config['propresenter_ip']+':'+config['propresenter_port']+'/stagedisplay' });
	
	//Connect and send the password
    webSocket.send({"pwd":config['propresenter_password'],"ptl":610,"acn":"ath"}).done(function() {
        // message send
		console.log("SENT AUTH");
    }).fail(function(e) {
        // error sending
    });

    // reconnected listening
    webSocket.listen(function(message) {
		if (message['acn'] != "vid") {
			console.log(message);
		}
		if (message['acn'] == "fv") {
			if (message['ary'][0]['txt'] != undefined) {
				console.log(message['ary']);
				//var lyric = message['ary'][0]['txt'].toUpperCase()
				var lyric = message['ary'][0]['txt'];
				$("#cs").html(lyric.replaceAll("\n","<br>"));
				var text = lyric.replaceAll("\n", "%0A");
				
				//Send slide data to vMix
				$.get("http://"+config['vmix_ip']+":"+config['vmix_port']+"/api/?Function=SetText&SelectedIndex=0&Input="+config['vmix_input']+"&Value="+text);
			}
		}
		
		
    });
	
	//Replace 127.0.0.1:8088 with the IP and Port of your vMix system
	$.get("http://127.0.0.1:8088/api", function(d) {
		console.log(d);
	});
	
	
String.prototype.replaceAll = function(search, replacement) {
    var target = this;
    return target.split(search).join(replacement);
};
</script>
</head>
<body>
	<h4>Current Slide</h4>
	<div id="cs"></div>
</body>
</html>